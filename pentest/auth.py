import requests
import random
from .models import *
from django.db.models import Q


# def filter_raw():
#     #
#     # 排除40X和50X的数据包，因为这样的数据包，没有越权的意义
#     results = proxy_data.objects.exclude(Q(status_code__icontains="40") | Q(status_code__icontains="50"))
#     for result in results:
#         if result.method == 'GET':
#             # http://192.168.1.105:7777/owasp-esapi-php/lib/simpletest/test/acceptance_test.php
#             # 直接只有页面，没有参数，适合cookie越权
#             if len(result.url.split('?')) == 1:
#                 r = auth_raw.objects.get_or_create(method=result.method, url=result.url)
#                 if r[1]:
#                     r[0].headers = result.request_headers
#                     r[0].cookies = result.request_cookies
#                     r[
#                         0].raw = result.method + ' ' + result.url + ' ' + result.http_version + '\n' + result.request_headers
#                     r[0].save()
#             elif len(result.url.split('?')) > 1:
#                 parms = result.url.split('?')[1]
#
#                 # http://192.168.1.105:7777/index.php?page=user-info.php
#                 if len(parms.split('&')) == 1:
#                     if auth_raw.objects.filter(url__icontains=parms.split('=')[0] + "=").count() == 0:
#                         auth_raw.objects.create(method=result.method,
#                                                 url=result.url,
#                                                 headers=result.request_headers,
#                                                 cookies=result.request_cookies,
#                                                 raw=result.method + ' ' + result.url + ' ' + result.http_version + '\n' + result.request_headers)
#                     else:
#                         # 重复的数据包不做操作
#                         pass
#                 elif len(parms.split('&')) > 2:
#                     pass
#                 else:
#                     pass
#
#
#         elif result.method == 'POST':
#             pass
#         else:
#             pass
