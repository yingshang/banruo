
from django.shortcuts import render,HttpResponse
from .models import domain_base_info,domain_detail_info
from .models import inject_data,filter_data,proxy_data
from .injection import autosqli,capture
from celery.decorators import task




def index(request):
    return render(request,"pentest/injection.html",locals())

def injection(request):
    proxy = proxy_data.objects.all()
    filter = filter_data.objects.all()
    inject = inject_data.objects.all()
    return  render(request,"pentest/injection.html",locals())

def display_proxy_data(request):
    id = request.GET.get("id")
    result = proxy_data.objects.get(id=id)
    return render(request, "pentest/display_proxy_data.html", locals())

def display_filter_data(request):
    id = request.GET.get("id")
    result = filter_data.objects.get(id=id)
    return render(request, "pentest/display_filter_data.html", locals())

def start_scan(request):
    scan()
    return HttpResponse('start scan')

def listen(request):
    capture()
    return HttpResponse('开始监听')

def injection_data(request):
    taskid = request.GET.get("taskid")
    result = inject_data.objects.get(taskid=taskid)
    return render(request,"pentest/injection_data.html",locals())

def setting(request):
    return render(request,'pentest/settings.html',locals())









@task
def scan():
    sqli = autosqli()
    sqli.start_scan()

@task
def scan_status():
    status = autosqli()
    status.data_scan()
